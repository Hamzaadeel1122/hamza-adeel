{% layout none %}

{{ 'popup-layout.css' | asset_url | stylesheet_tag }}
<div class="popup-product-details">
  <button class="close-popup" aria-label="Close popup">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
    <path d="M5.0376 4.94354L13.5229 13.4288" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
    <path d="M5.0376 13.4285L13.5229 4.94325" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="product-info-container">
    <div class="product-image">
      <img 
        class="popup-product-image" 
        src="{{ product.featured_image | image_url: width: 120 }}" 
        alt="{{ product.featured_image.alt | escape }}"
        width="{{product.featured_image.width}}"
        height="{{product.featured_image.height}}"
        loading="lazy"
      >
    </div>

    <div class="product-info">
      <h2 class="popup-product-title">{{ product.title }}</h2>
      <div class="popup-product-price">
        {{ product.price | money }}
      </div>
      <div class="popup-product-description">
        {{ product.description }}
      </div>
    </div>
  </div>

  <script type="application/json" id="product-variants">
    {{ product.variants | json }}
  </script>
  <product-form>
    {%- form 'product', product, id: 'product-form-popup', class: 'form' -%}
      <div class="product-form__error-message-wrapper" role="alert" hidden>
        <span class="svg-wrapper">
          {{- 'icon-error.svg' | inline_asset_content -}}
        </span>
        <span class="product-form__error-message"></span>
      </div>
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
      
      {%- for option in product.options_with_values -%}
        <div class="product-form__input-{{forloop.index}}">
          <label class="form__label" for="Option-{{ forloop.index0 }}">
            {{ option.name }}
          </label>
          {% if option.name == 'Color' %}
            <div class="color-options" data-selected="0">
              {%- for value in option.values -%}
                <div 
                  class="color-option {% if option.selected_value == value %}selected{% endif %}"
                  data-value="{{ value | escape }}"
                  style="--color-indicator: {{ value }};"
                >
                  {{ value }}
                </div>
              {%- endfor -%}
            </div>
            <select 
              id="Option-{{ forloop.index0 }}"
              class="select__select hidden"
              name="options[{{ option.name | escape }}]"
              form="product-form-popup"
            >
              {%- for value in option.values -%}
                <option
                  value="{{ value | escape }}"
                  {% if option.selected_value == value %}selected="selected"{% endif %}
                >
                  {{ value }}
                </option>
              {%- endfor -%}
            </select>
          {% else %}
            <select 
              id="Option-{{ forloop.index0 }}"
              class="select__select select-wrappe"
              name="options[{{ option.name | escape }}]"
              form="product-form-popup"
            >
            <option value="" disabled selected>Choose your size</option>
              {%- for value in option.values -%}
                <option
                  value="{{ value | escape }}"
                {% if option.selected_value == value %}selected="selected"{% endif %}
                >
                  {{ value }}
                </option>
              {%- endfor -%}
            </select>
          {% endif %}
        </div>
      {%- endfor -%}

      <button
        type="submit"
        name="add"
        class="button button--full-width"
        {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}
      >
        <span>ADD TO CART</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="12" viewBox="0 0 36 12" fill="none">
        <path d="M1.4093 5.25L0.659302 5.25L0.659302 6.75L1.4093 6.75L1.4093 5.25ZM35.6391 6.53033C35.932 6.23744 35.932 5.76257 35.6391 5.46967L30.8661 0.696701C30.5733 0.403808 30.0984 0.403808 29.8055 0.696701C29.5126 0.989594 29.5126 1.46447 29.8055 1.75736L34.0481 6L29.8055 10.2426C29.5126 10.5355 29.5126 11.0104 29.8055 11.3033C30.0984 11.5962 30.5732 11.5962 30.8661 11.3033L35.6391 6.53033ZM1.4093 6.75L35.1088 6.75L35.1088 5.25L1.4093 5.25L1.4093 6.75Z" fill="white"/>
        </svg>
        {%- render 'loading-spinner' -%}
      </button>
    {%- endform -%}
  </product-form>
</div>

{% layout none %}
